// ===============================================================
// ЁЯЯж ржкрзНрж░рзЯрзЛржЬржирзАрзЯ ржЯрж╛ржЗржк import ржХрж░рж╛
// IncomingMessage тЖТ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯ ржерзЗржХрзЗ ржЖрж╕рж╛ Request
// ServerResponse тЖТ рж╕рж╛рж░рзНржнрж╛рж░ ржерзЗржХрзЗ ржкрж╛ржарж╛ржирзЛ Response
// ===============================================================
import { IncomingMessage, ServerResponse } from "http";

// ===============================================================
// ЁЯЯй RouteHandler ржЯрж╛ржЗржк
// ---------------------------------------------------------------
// ржПржЯрж╛ ржПржоржи ржПржХржЯрж┐ function-ржПрж░ type ржпрзЗржЯрж╛:
//   тЬФ req (IncomingMessage) ржирзЗржмрзЗ
//   тЬФ res (ServerResponse) ржирзЗржмрзЗ
//   тЬФ ржПржмржВ ржХрж┐ржЫрзБ return ржХрж░ржмрзЗ ржирж╛ (void)
// ржорзВрж▓ржд: ржкрзНрж░рждрж┐ржЯрж┐ route ржХрзЛржи function ржжрж┐рзЯрзЗ handle рж╣ржмрзЗ, рждрж╛ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рзЗ
// ===============================================================
export type RouteHandeler = (req: IncomingMessage, res: ServerResponse) => void;

// ===============================================================
// ЁЯЯз Nested Map structure
// ---------------------------------------------------------------
// route = {
//   "GET"  тЖТ { "/hello" тЖТ handlerFunction },
//   "POST" тЖТ { "/users" тЖТ handlerFunction }
// }
//
// Map<string, Map<string, RouteHandler>>
//    тЖС method  тЖС path ржУ рждрж╛рж░ рж╕рж╛ржерзЗ handler
//
// ржкрзНрж░ржержо Map тЖТ method ржЕржирзБржпрж╛рзЯрзА route рж░рж╛ржЦрж╛
// ржжрзНржмрж┐рждрзАрзЯ Map тЖТ path ржЕржирзБржпрж╛рзЯрзА handler рж░рж╛ржЦрж╛
// ===============================================================
export const route: Map<string, Map<string, RouteHandeler>> = new Map();

// ===============================================================
// ЁЯЯж addRoutes ржлрж╛ржВрж╢ржи
// ---------------------------------------------------------------
// ржПржЗ ржлрж╛ржВрж╢ржирзЗрж░ ржХрж╛ржЬ:
//   тЬФ ржХрзЛржи method (GET/POST/PUT...) ржПрж░ ржЬржирзНржп
//   тЬФ ржХрзЛржи URL path ("/users", "/home" ...)
//   тЬФ ржХрзЛржи handler function ржЪрж▓ржмрзЗ
// рж╕рзЗржЧрзБрж▓рзЛ nested Map-ржП ржпрзЛржЧ ржХрж░рзЗ рж░рж╛ржЦрж╛
// ===============================================================
const addRoutes = (mathod: string, path: string, handeler: RouteHandeler) => {
  // -----------------------------------------------------------
  // ржпржжрж┐ ржПржЗ method-ржПрж░ (ржпрзЗржоржи GET) ржЬржирзНржп Map ржирж╛ ржерж╛ржХрзЗ,
  // рждрж╛рж╣рж▓рзЗ ржкрзНрж░ржержорзЗ рж╕рзЗржЗ method-ржПрж░ ржЬржирзНржп ржирждрзБржи Map рждрзИрж░рж┐ ржХрж░рзЛред
  // -----------------------------------------------------------
  if (!route.has(mathod)) route.set(mathod, new Map());

  // -----------------------------------------------------------
  // ржПрж░ржкрж░ рж╕рзЗржЗ method-ржПрж░ ржнрзЗрждрж░рзЗрж░ Map ржерзЗржХрзЗ path ржирж┐рзЯрзЗ
  // рждрж╛рж░ рж╕рж╛ржерзЗ handler function рж╕рзЗржЯ ржХрж░рзЗ ржжрж╛ржУред
  // ржЙржжрж╛рж╣рж░ржг:
  // route.get("GET")?.set("/hello", helloHandler)
  // -----------------------------------------------------------
  route.get(mathod)?.set(path, handeler);
};

// ===============================================================
// ЁЯЯй ржПржЗ ржлрж╛ржВрж╢ржи export ржХрж░рж╛
// ---------------------------------------------------------------
// ржпрж╛рждрзЗ ржЕржирзНржп ржлрж╛ржЗрж▓ addRoutes() ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ
// рж░рж╛ржЙржЯ рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗ
// ===============================================================
export default addRoutes;
